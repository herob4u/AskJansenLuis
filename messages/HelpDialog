using System;
using System.Threading.Tasks;
using Microsoft.Bot.Builder.Dialogs;
using Microsoft.Bot.Connector;
using System.Collections.Generic;
using Database;

[Serializable]
class HelpDialog : IDialog
{
    public async Task StartAsync(IDialogContext context)
    {
        PromptDialog.Choice<string>(context, TopicSelectedAsync, HelpTopicSelector.Instance.Topics, "Select a Topic");
    }


    private async Task TopicSelectedAsync(IDialogContext context, IAwaitable<string> result)
    {
        try
        {
            string selection = await result;

            if (HelpTopicSelector.Instance.IsQuestionNode(selection))
            {
                await context.PostAsync($"You asked: {selection}");
                HelpTopicSelector.Instance.Reset();
                context.Done<string>(selection);
            }
            else
            {
                HelpTopicSelector.Instance.SelectElement(selection);
                await this.StartAsync(context);
            }
        }

        catch(TooManyAttemptsException)
        {
            await context.PostAsync("Too many failed attempts!");
            await this.StartAsync(context);
        }
    }
}
